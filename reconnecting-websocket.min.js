!function(){function e(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),t}e.prototype=window.Event.prototype,window.CustomEvent=e}(),function(e,n){"function"==typeof define&&define.amd?define([],n):"undefined"!=typeof module&&module.exports?module.exports=n():e.ReconnectingWebSocket=n()}(this,function(){function e(n,t,o){var c={automaticOpen:!0,binaryType:"blob",debug:!1,ignoreProxyConnectionErrors:!0,maxReconnectAttempts:null,maxReconnectInterval:3e4,randomizeReconnect:!1,reconnectDecay:1.5,reconnectInterval:1e3,timeoutInterval:2e3};o||(o={});for(var i in c)"undefined"!=typeof o[i]?this[i]=o[i]:this[i]=c[i];this.url=n,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var s,r=this,a=!1,u=!1,d=document.createElement("div");d.addEventListener("open",function(e){r.onopen(e)}),d.addEventListener("close",function(e){r.onclose(e)}),d.addEventListener("connecting",function(e){r.onconnecting(e)}),d.addEventListener("message",function(e){r.onmessage(e)}),d.addEventListener("error",function(e){r.onerror(e)}),this.addEventListener=d.addEventListener.bind(d),this.removeEventListener=d.removeEventListener.bind(d),this.dispatchEvent=d.dispatchEvent.bind(d),this.open=function(n){if(s=new WebSocket(r.url,t||[]),s.binaryType=this.binaryType,n){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else d.dispatchEvent(new CustomEvent("connecting")),this.reconnectAttempts=0;(r.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",r.url);var o=s,c=setTimeout(function(){(r.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",r.url),u=!0,o.close(),u=!1},r.timeoutInterval);s.onopen=function(t){clearTimeout(c),(r.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",r.url,t),r.protocol=s.protocol,r.readyState=WebSocket.OPEN,r.reconnectAttempts=0,d.dispatchEvent(new CustomEvent("open",{detail:{isReconnect:n}})),n=!1},s.onclose=function(t){if(clearTimeout(o),s=null,a)r.readyState=WebSocket.CLOSED,d.dispatchEvent(new CustomEvent("close",{detail:{code:t.code,reason:t.reason,wasClean:t.wasClean}}));else{if(r.readyState=WebSocket.CONNECTING,d.dispatchEvent(new CustomEvent("connecting",{detail:{code:t.code,reason:t.reason,wasClean:t.wasClean}})),!n&&!u&&((r.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",r.url,t),d.dispatchEvent(new CustomEvent("close",{detail:{code:t.code,reason:t.reason,wasClean:t.wasClean}})),!r.ignoreProxyConnectionErrors))switch(t.code){case 1002:case 1003:case 1004:case 1005:case 1006:case 1007:case 1008:case 1009:return}var o=(r.reconnectInterval+(r.randomizeReconnect?Math.random():0))*Math.pow(r.reconnectDecay,r.reconnectAttempts);setTimeout(function(){r.reconnectAttempts++,r.open(!0)},o>r.maxReconnectInterval?r.maxReconnectInterval:o)}},s.onmessage=function(n){(r.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",r.url,n),d.dispatchEvent(new CustomEvent("message",{detail:{data:n.data}}))},s.onerror=function(n){(r.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",r.url,n),d.dispatchEvent(new CustomEvent("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(n){if(s)return(r.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",r.url,n),s.send(n);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,n){"undefined"==typeof e&&(e=1e3),a=!0,s&&s.close(e,n)},this.refresh=function(){s&&s.close()}}if("WebSocket"in window)return e.prototype.onopen=function(e){},e.prototype.onclose=function(e){},e.prototype.onconnecting=function(e){},e.prototype.onmessage=function(e){},e.prototype.onerror=function(e){},e.debugAll=!1,e.CONNECTING=WebSocket.CONNECTING,e.OPEN=WebSocket.OPEN,e.CLOSING=WebSocket.CLOSING,e.CLOSED=WebSocket.CLOSED,e});
